const XState = require('xstate')
const { Machine, interpret, assign } = XState

module.exports = Machine({
  initial: 'creating',
  states: {
    creating: {
      invoke: {
        id: 'create', src: 'create_account_keypair',
        onDone: {
          target: 'registering',
          actions: (_, event) => console.log('user-sm:', event.data)
        },
        onError: {
          target: 'finish',
          actions: (_, event) => console.log('user-sm:', event.data)
        }
      },
    },
    registering: {
      invoke: {
        id: 'register', src: 'registering_roles',
        onDone: {
          target: 'publishing',
          actions: (_, event) => console.log('user-sm:', event.data)
        },
        onError: {
          target: 'finish',
          actions: (_, event) => console.log('user-sm:', event.data)
        }
      },
    },
    publishing: {
      invoke: {
        id: 'report', src: 'publish_to_chain',
        onDone: {
          target: 'finish',
          actions: (_, event) => console.log('user-sm:', event.data)
        },
        onError: {
          target: 'finish',
          actions: (_, event) => console.log('user-sm:', event.data)
        }
      },
    },
    finish: {
      type: 'final',
      data: {type: 'finished'}
    },
    
  }
}, {
  services: {
    create_account_keypair: new Promise((resolve, reject) => { setTimeout(() => { resolve('created') }, 3000) }),
    registering_roles: new Promise((resolve, reject) => { setTimeout(() => { resolve('registered') }, 3000) }),
    publish_to_chain: new Promise((resolve, reject) => { setTimeout(() => { resolve('published') }, 3000) }),
  }
})
